var TSN2={page:$("body"),stripe_pk:$("input[name=stripe_pk]").val(),subscription_form:$(".subscription_form"),init:function(){var e=this;Stripe.setPublishableKey(e.stripe_pk),e.attach_events(),e.page.find(".js-submit_comment").hide()},attach_events:function(){var e=this;return e.page.delegate(".js-action, .js-disabled","click",function(e){e.preventDefault()}).delegate(".js-like, .js-delete_comment, .js-pricepoint","click",function(){var e=$(this),t=e.attr("href")+"&response_type=json";if(e.hasClass("js-like"))$.ajax({url:t,success:function(n){var i=e.closest(".comment, .post_operations").find(".js-nb_likes"),s=null;switch(n.likes){case 0:s="";break;case 1:s=" &middot; "+n.likes+" like";break;default:s=" &middot; "+n.likes+" likes"}i.html(s),"like"===e.text().toLowerCase()?(t=t.replace("action=like","action=unlike"),e.text("Unlike").attr("href",t)):(t=t.replace("action=unlike","action=like"),e.text("Like").attr("href",t))}});else if(e.hasClass("js-delete_comment"))$.ajax({type:"DELETE",url:t,success:function(t){var n=e.closest(".comments").parent().find(".js-nb_comments"),i=null;switch(t.comments){case 0:i="";break;case 1:i=" &middot; "+t.comments+" comment";break;default:i=" &middot; "+t.comments+" comments"}n.html(i),e.closest(".comment").remove()}});else if(e.hasClass("js-pricepoint")){var n=$(this),i=n.closest("table"),s=i.find(".pricepoint"),a=n.find("input[type=radio]");s.removeClass("current"),n.addClass("current"),a.prop("checked",!0)}}),e.page.find(".js-input_comment").keypress(function(e){var t,n,i=$(this),s=i.closest(".comments"),a=s.find(".comment").last(),o=i.val(),r=i.closest("form"),c=r.closest(".comment_posting_section"),l=r.attr("action")+"&response_type=json",m=r.find("input[name=post_id]").val(),d=r.find("input[name=video_id]").val(),p=r.find("input[name=album_id]").val(),u=r.find("input[name=picture_id]").val(),f=(r.find("input[name=current_user_id]").val(),r.find("input[name=current_user_fullname]").val()),_={value:o};void 0!==m?_.post_id=m:void 0!==d?_.video_id=d:void 0!==p?_.album_id=p:void 0!==u&&(_.picture_id=u),e=e||window.event,t=window.event?e.keyCode:e.which,13===t&&(e.preventDefault(),$.ajax({type:"POST",url:l,data:_,success:function(e){var t=s.parent().find(".js-nb_comments"),o=null;switch(e.comments){case 0:o="";break;case 1:o=" &middot; "+e.comments+" comment";break;default:o=" &middot; "+e.comments+" comments"}t.html(o),n=$("#comment").html(),e.user_fullname=f,i.val(""),0!==a.length?a.after(Mustache.render(n,e)):c.prepend(Mustache.render(n,e))},error:function(){alert("nah bitch")}}))}),e.page.find(".js-comment").click(function(){var e=$(this),t=e.closest(".single_post"),t=0!==t.length?t:e.closest(".content"),n=t.find(".js-input_comment");n.focus()}),e.subscription_form.submit(function(t){return e.subscription_form.find(".submit").prop("disabled",!0),Stripe.card.createToken(e.subscription_form,e.stripeResponseHandler),!1}),e},stripeResponseHandler:function(e,t){var n=$(".subscription_form");if(t.error)n.find(".payment-errors").text(t.error.message),n.find(".submit").prop("disabled",!1);else{var i=t.id;n.append($('<input type="hidden" name="stripeToken">').val(i)),n.get(0).submit()}}};TSN2.init();